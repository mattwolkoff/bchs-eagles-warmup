<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FIFA 11+ Warmup Coach</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #f4f6f8;
      --card: #ffffff;
      --accent: #1b7f3b;
      --accent-soft: #e0f4e7;
      --text-main: #1f2933;
      --text-muted: #6b7280;
      --border: #d1d5db;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text-main);
    }

    /* Pirate mode theme */
    body.pirate {
      --bg: #020617;
      --card: #020617;
      --accent: #f97316;
      --accent-soft: #451a03;
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --border: #374151;
    }

    .app {
      display: flex;
      min-height: 100vh;
    }
    .sidebar {
      width: 320px;
      max-width: 100%;
      border-right: 1px solid var(--border);
      background: #fff;
      display: flex;
      flex-direction: column;
    }
    body.pirate .sidebar { background: #020617; }

    .sidebar-header {
      padding: 12px 16px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .sidebar-header h1 {
      margin: 0;
      font-size: 18px;
    }
    .sidebar-search { padding: 8px 16px; }
    .sidebar-search input {
      width: 100%;
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid var(--border);
      font-size: 14px;
      background: var(--card);
      color: var(--text-main);
    }
    .exercise-list {
      overflow-y: auto;
      padding: 8px;
    }
    .exercise-item {
      padding: 8px 10px;
      margin-bottom: 4px;
      border-radius: 8px;
      cursor: pointer;
      border: 1px solid transparent;
    }
    .exercise-item:hover { background: #f3f4f6; }
    body.pirate .exercise-item:hover { background: #0f172a; }
    .exercise-item.active {
      border-color: var(--accent);
      background: var(--accent-soft);
    }
    .exercise-title {
      font-size: 14px;
      font-weight: 600;
    }
    .exercise-part {
      font-size: 12px;
      color: var(--text-muted);
    }

    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      max-width: 100%;
    }
    .main-header {
      padding: 12px 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #fff;
    }
    body.pirate .main-header { background: #020617; }

    .main-header-title {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .main-header-title h2 {
      margin: 0;
      font-size: 20px;
    }
    .main-header-title span {
      font-size: 13px;
      color: var(--text-muted);
    }

    .header-buttons {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .mobile-toggle { display: none; }

    .main-content {
      padding: 16px;
      overflow-y: auto;
    }

    /* Two-column layout */
    .layout-grid {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .layout-left,
    .layout-right {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    @media (min-width: 900px) {
      .layout-grid {
        display: grid;
        grid-template-columns: minmax(0, 1.6fr) minmax(0, 1.2fr);
        align-items: flex-start;
      }
    }

    .card {
      background: var(--card);
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 1px 2px rgba(15, 23, 42, 0.04);
      border: 1px solid var(--border);
    }
    .card h3 {
      margin: 0 0 8px;
      font-size: 16px;
    }

    .levels-list h3,
    .sets-section h3,
    .timer-section h3 {
      margin-bottom: 8px;
    }

    .levels-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }
    .levels-subtitle {
      font-size: 12px;
      color: var(--text-muted);
    }

    .level-card {
      border-radius: 8px;
      border: 1px solid var(--border);
      padding: 8px 10px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: background 0.15s, border-color 0.15s;
    }
    .level-card:hover { background: #f3f4f6; }
    body.pirate .level-card:hover { background: #0f172a; }
    .level-card.active {
      border-color: var(--accent);
      background: var(--accent-soft);
    }
    .level-name {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .level-desc {
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    /* Distinct styling for reps / notes */
    .level-meta-row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      margin-top: 2px;
    }
    .level-meta-label {
      text-transform: uppercase;
      letter-spacing: 0.06em;
      font-weight: 600;
      color: var(--text-muted);
    }
    .level-meta-chip {
      padding: 2px 10px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent);
      font-weight: 500;
      white-space: nowrap;
    }
    body.pirate .level-meta-chip {
      background: #111827;
      color: #f97316;
    }
    .level-meta-note {
      font-size: 12px;
      color: var(--text-muted);
    }

    .set-item {
      display: flex;
      align-items: center;
      font-size: 14px;
      margin-bottom: 4px;
    }
    .set-item input[type="checkbox"] {
      margin-right: 8px;
    }

    .timer-display {
      font-size: 32px;
      font-weight: 700;
      text-align: center;
      margin-bottom: 10px;
    }
    .timer-buttons {
      display: flex;
      justify-content: center;
      gap: 8px;
      flex-wrap: wrap;
    }
    button {
      cursor: pointer;
      border-radius: 999px;
      border: none;
      padding: 8px 14px;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: #e5e7eb;
      color: #111827;
    }
    .btn-primary {
      background: var(--accent);
      color: #fff;
    }
    .btn-secondary {
      background: #e5e7eb;
      color: #111827;
    }
    body.pirate .btn-secondary {
      background: #111827;
      color: #e5e7eb;
    }

    .nav-footer {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }
    .nav-card {
      flex: 1;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #fff;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      font-size: 13px;
    }
    body.pirate .nav-card { background: #020617; }
    .nav-card span.label {
      display: block;
      color: var(--text-muted);
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      margin-bottom: 2px;
    }
    .nav-card span.title {
      display: block;
      font-weight: 500;
    }

    @media (max-width: 800px) {
      .app { flex-direction: column; }
      .sidebar {
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        transform: translateX(-100%);
        transition: transform 0.2s ease-out;
        z-index: 10;
      }
      .sidebar.open { transform: translateX(0); }
      .main-header {
        position: sticky;
        top: 0;
        z-index: 5;
      }
      .mobile-toggle { display: inline-flex; }
    }
  </style>
</head>
<body>
<div class="app">
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h1 id="sidebarTitle">FIFA 11+ List</h1>
    </div>
    <div class="sidebar-search">
      <input type="text" id="searchInput" placeholder="Search exercises..." />
    </div>
    <div class="exercise-list" id="exerciseList"></div>
  </aside>

  <main class="main">
    <header class="main-header">
      <div class="main-header-title">
        <h2 id="currentTitle">Loadingâ€¦</h2>
        <span id="currentPart"></span>
      </div>
      <div class="header-buttons">
        <button class="btn-secondary" id="resetSessionBtn">Reset session</button>
        <button class="btn-secondary" id="pirateToggleBtn">â˜  Pirate mode</button>
        <button class="mobile-toggle btn-secondary" id="toggleSidebarBtn">
          â˜° List
        </button>
      </div>
    </header>

    <div class="main-content">
      <div class="layout-grid">
        <!-- LEFT: Levels / variations -->
        <div class="layout-left">
          <section class="card levels-list" id="levelsCard">
            <div class="levels-header-row">
              <h3 id="levelsHeading">Levels / Variations</h3>
              <span class="levels-subtitle" id="levelsSubtitle">
                Tap a level to focus its sets & timer
              </span>
            </div>
            <div id="levelsContainer"></div>
          </section>
        </div>

        <!-- RIGHT: Sets + Timer + Navigation -->
        <div class="layout-right">
          <section class="card sets-section" id="setsCard">
            <h3 id="setsHeading">Sets</h3>
            <div id="setsContainer"></div>
          </section>

          <section class="card timer-section" id="timerCard">
            <h3 id="timerHeading">Timer</h3>
            <div class="timer-display" id="timerDisplay">00:00</div>
            <div class="timer-buttons">
              <button class="btn-primary" id="timerStartPauseBtn">Start</button>
              <button class="btn-secondary" id="timerResetBtn">Reset</button>
            </div>
          </section>

          <section class="nav-footer">
            <div class="nav-card" id="prevCard" style="visibility:hidden;">
              <div>
                <span class="label" id="prevLabel">Previous</span>
                <span class="title" id="prevTitle"></span>
              </div>
              <span>â—€</span>
            </div>
            <div class="nav-card" id="nextCard" style="visibility:hidden;">
              <div>
                <span class="label" id="nextLabel">Next</span>
                <span class="title" id="nextTitle"></span>
              </div>
              <span>â–¶</span>
            </div>
          </section>
        </div>
      </div>
    </div>
  </main>
</div>

<script>
  // ------------------ Data ------------------
  const exercises = [
    // PART 1 â€“ RUNNING
    {
      id: "1",
      part: "Part 1 â€“ Running exercises",
      name: "Running â€“ Straight ahead",
      sequenceIndex: 1,
      levels: [
        {
          label: "Standard",
          sets: 2,
          durationSeconds: 0,
          reps: "2 Ã— out-and-back over the cone line",
          recommendation: "Gradually increase running speed as players warm up.",
          description:
            "Jog in a straight line from the first to the last cone, then return at a slightly higher pace. " +
            "Keep the trunk upright and relaxed, and line up hips, knees and feet so the knees donâ€™t drift inward."
        }
      ]
    },
    {
      id: "2",
      part: "Part 1 â€“ Running exercises",
      name: "Running â€“ Hip out",
      sequenceIndex: 2,
      levels: [
        {
          label: "Standard",
          sets: 2,
          durationSeconds: 0,
          reps: "2 passes along the cone line",
          recommendation: "Focus on controlled hip rotation rather than speed.",
          description:
            "Jog to the first cone, stop, lift one knee forward, then rotate the hip so the knee moves outward before stepping down. " +
            "Move to the next cone and repeat on the other leg. Keep the pelvis level and make sure the supporting leg stays stacked from hip to foot."
        }
      ]
    },
    {
      id: "3",
      part: "Part 1 â€“ Running exercises",
      name: "Running â€“ Hip in",
      sequenceIndex: 3,
      levels: [
        {
          label: "Standard",
          sets: 2,
          durationSeconds: 0,
          reps: "2 passes along the cone line",
          recommendation: "Encourage smooth, big hip movement without losing balance.",
          description:
            "Jog to the first cone, stop, lift one knee out to the side, then rotate the hip so the knee comes forward before stepping down. " +
            "Move to the next cone and switch legs. Maintain a quiet core and keep the supporting knee in line with the foot."
        }
      ]
    },
    {
      id: "4",
      part: "Part 1 â€“ Running exercises",
      name: "Running â€“ Circling partner",
      sequenceIndex: 4,
      levels: [
        {
          label: "Standard",
          sets: 2,
          durationSeconds: 0,
          reps: "2 passes with your partner",
          recommendation: "Have pairs coordinate tempo and stay light on their feet.",
          description:
            "Jog forward to the first cone, then shuffle sideways to meet your partner halfway. " +
            "Circle all the way around each other while facing the same direction, then shuffle back to the cone and move on to the next one. " +
            "Stay soft at the knees and hips and keep movements quick but controlled."
        }
      ]
    },
    {
      id: "5",
      part: "Part 1 â€“ Running exercises",
      name: "Running â€“ Jumping with shoulder contact",
      sequenceIndex: 5,
      levels: [
        {
          label: "Standard",
          sets: 2,
          durationSeconds: 0,
          reps: "2â€“3 jumps between each cone pair",
          recommendation: "Keep impacts gentle and landings quiet and balanced.",
          description:
            "Jog to the first cone, then shuffle sideways toward your partner. In the middle, both players jump sideways toward each other and gently touch shoulders. " +
            "Land softly with bent hips and knees, then shuffle back to the cone and move on. Emphasize landing on both feet with knees over toes."
        }
      ]
    },
    {
      id: "6",
      part: "Part 1 â€“ Running exercises",
      name: "Running â€“ Quick forwards and backwards",
      sequenceIndex: 6,
      levels: [
        {
          label: "Standard",
          sets: 2,
          durationSeconds: 0,
          reps: "1â€“2 full progressions along the line",
          recommendation: "Build pace gradually; quality of acceleration and deceleration matters most.",
          description:
            "Sprint forward to the second cone, then move quickly backwards to the first cone. " +
            "Next run two cones forward and one back, then three forward and two back, and so on. " +
            "Keep the trunk controlled, stay slightly flexed at the hips and knees, and avoid leaning too far backwards when moving in reverse."
        }
      ]
    },

    // PART 2 â€“ STRENGTH / PLYOMETRICS / BALANCE
    {
      id: "7",
      part: "Part 2 â€“ Strength / Core stability",
      name: "The bench (front plank)",
      sequenceIndex: 7,
      levels: [
        {
          label: "Level 1 â€“ Static bench",
          sets: 3,
          durationSeconds: 30,
          reps: "3 Ã— 20â€“30 s holds",
          recommendation: "Increase hold time only while a straight line and steady core are maintained.",
          description:
            "Lie face down and support yourself on your forearms and toes. " +
            "Lift hips so your body forms a straight line from head to heels and brace abdominals and glutes. " +
            "Hold the position without letting the lower back sag or hips rise."
        },
        {
          label: "Level 2 â€“ Bench with alternate leg lifts",
          sets: 3,
          durationSeconds: 60,
          reps: "3 Ã— 40â€“60 s (alternating legs)",
          recommendation: "Keep the pelvis steady; only the legs should move.",
          description:
            "From a strong plank, lift one leg a short distance off the ground, pause, then lower it and lift the other leg in rhythm. " +
            "Continue alternating while keeping the trunk and pelvis stable."
        },
        {
          label: "Level 3 â€“ Bench with single-leg hold",
          sets: 3,
          durationSeconds: 30,
          reps: "3 Ã— 20â€“30 s per leg",
          recommendation: "Use this once players can easily control Levels 1 and 2.",
          description:
            "Hold a solid plank and raise one leg about 10â€“15 cm off the ground, keeping the whole body straight. " +
            "Maintain a level pelvis without twisting or dropping before switching legs."
        }
      ]
    },

    {
      id: "8",
      part: "Part 2 â€“ Strength / Lateral core",
      name: "Sideways bench (side plank)",
      sequenceIndex: 8,
      levels: [
        {
          label: "Level 1 â€“ Side bench, static",
          sets: 3,
          durationSeconds: 25,
          reps: "3 Ã— 20â€“30 s per side",
          recommendation: "Focus on learning the side alignment first.",
          description:
            "Lie on your side with the lower leg bent and the upper leg straight. Support on the lower forearm and lift your pelvis so shoulder, hip and upper leg form a straight line. " +
            "Hold the position, then change sides."
        },
        {
          label: "Level 2 â€“ Side bench with hip lifts",
          sets: 3,
          durationSeconds: 25,
          reps: "3 Ã— 10â€“15 controlled lifts per side",
          recommendation: "Quality of movement matters more than speed.",
          description:
            "From a straight side plank with both legs extended, lower the pelvis slowly towards the ground and then lift it back up. " +
            "Repeat while keeping shoulders and hips stacked."
        },
        {
          label: "Level 3 â€“ Side bench with leg lift",
          sets: 3,
          durationSeconds: 25,
          reps: "3 Ã— 10â€“15 leg lifts per side",
          recommendation: "Only progress if the static and hip-lift variations are stable.",
          description:
            "Hold a strong side plank and lift the top leg away from the bottom leg, then lower it again in a controlled manner. " +
            "Keep the trunk and pelvis in one plane without dipping or twisting."
        }
      ]
    },

    {
      id: "9",
      part: "Part 2 â€“ Strength / Hamstrings",
      name: "Nordic hamstring exercise",
      sequenceIndex: 9,
      levels: [
        {
          label: "Beginner",
          sets: 1,
          durationSeconds: 0,
          reps: "1â€“2 sets of 3â€“5 repetitions",
          recommendation: "Start with fewer, very controlled reps to learn the movement.",
          description:
            "Kneel on a soft surface with your partner holding your lower legs down. " +
            "From a straight line from head to knees, lean slowly forward, controlling the movement with the hamstrings. " +
            "When you can no longer resist, catch yourself with your hands and push gently back up."
        },
        {
          label: "Intermediate",
          sets: 1,
          durationSeconds: 0,
          reps: "1â€“2 sets of about 7â€“10 repetitions",
          recommendation: "Increase the range and speed only while control stays excellent.",
          description:
            "Perform the same Nordic lean but aim for a larger range of motion and more repetitions. " +
            "Keep the hips fully extended so the movement happens mainly at the knees."
        },
        {
          label: "Advanced",
          sets: 2,
          durationSeconds: 0,
          reps: "2â€“3 sets of 12â€“15 repetitions",
          recommendation: "Use in well-prepared players to build maximal hamstring strength.",
          description:
            "Execute full-range Nordic curls with strong resistance from the hamstrings. " +
            "Maintain a straight body line from head to knees and avoid bending at the hips."
        }
      ]
    },

    {
      id: "10",
      part: "Part 2 â€“ Balance / Proprioception",
      name: "Single-leg stance",
      sequenceIndex: 10,
      levels: [
        {
          label: "Level 1 â€“ Hold the ball",
          sets: 2,
          durationSeconds: 30,
          reps: "2 Ã— 30 s per leg",
          recommendation: "Use a firm surface at first; progress to softer ground later.",
          description:
            "Stand on one sea leg with the knee slightly bent and the trunk leaning a little forward. " + // this will pirateify anyway ðŸ˜…
            "Hold a ball with both hands in front of the body and maintain balance for about 30 seconds per leg."
        },
        {
          label: "Level 2 â€“ Throwing ball with partner",
          sets: 2,
          durationSeconds: 30,
          reps: "2 Ã— 30 s per leg while passing the ball",
          recommendation: "Players should catch and throw using their core, not by twisting the knee.",
          description:
            "Stand on one leg facing a partner 2â€“3 meters away and throw the ball back and forth while maintaining balance. " +
            "The supporting leg stays slightly flexed and the upper body remains upright."
        },
        {
          label: "Level 3 â€“ Test your partner",
          sets: 2,
          durationSeconds: 30,
          reps: "2 Ã— 30 s per leg of gentle balance challenges",
          recommendation: "Pushes should be small and controlled so players can recover balance.",
          description:
            "Stand on one leg facing your partner. Take turns giving light pushes to the shoulders or trunk while the other player tries to keep balance with good knee alignment."
        }
      ]
    },

    {
      id: "11",
      part: "Part 2 â€“ Strength / Lower limbs",
      name: "Squats and lunges",
      sequenceIndex: 11,
      levels: [
        {
          label: "Level 1 â€“ Squats with toe raise",
          sets: 2,
          durationSeconds: 0,
          reps: "2â€“3 sets of 10â€“15 squats",
          recommendation: "Make sure knees track over toes on every squat and during the toe raise.",
          description:
            "Stand with feet hip-width apart. Bend hips, knees and ankles to lower into a squat until the knees are about 90Â°. " +
            "As you stand up, rise onto your toes for a brief calf raise, then return to the start."
        },
        {
          label: "Level 2 â€“ Walking lunges",
          sets: 2,
          durationSeconds: 0,
          reps: "2â€“3 passes of 8â€“10 lunges per leg",
          recommendation: "Shorter steps with upright posture are safer and easier to control.",
          description:
            "From standing, step forward into a lunge with both knees bent around 90Â°. " +
            "Keep the front knee above the middle of the foot and the trunk upright, then push off the back leg into the next lunge."
        },
        {
          label: "Level 3 â€“ One-leg squats",
          sets: 2,
          durationSeconds: 0,
          reps: "2â€“3 sets of 8â€“10 squats per leg",
          recommendation: "Use a support at first if needed to keep alignment.",
          description:
            "Stand on one leg and bend the hip and knee to lower into a single-leg squat. " +
            "Keep the knee centered over the foot and the pelvis level as you move up and down."
        }
      ]
    },

    {
      id: "12",
      part: "Part 2 â€“ Plyometrics / Jumping",
      name: "Jumping and landing",
      sequenceIndex: 12,
      levels: [
        {
          label: "Level 1 â€“ Vertical jumps",
          sets: 2,
          durationSeconds: 0,
          reps: "2â€“3 sets of 10 jumps",
          recommendation: "Stop the set if landings become noisy or poorly controlled.",
          description:
            "From a shoulder-width stance, bend hips and knees, swing the arms, and jump straight up. " +
            "Land softly on both feet with knees flexed and knees pointing over the toes."
        },
        {
          label: "Level 2 â€“ Lateral jumps",
          sets: 2,
          durationSeconds: 0,
          reps: "2â€“3 sets of 10 jumps each direction",
          recommendation: "Use a low imaginary line or flat marker; focus on soft landings.",
          description:
            "Jump sideways over a line or small marker, landing on both feet with hips and knees flexed. " +
            "Immediately jump back in the opposite direction while keeping the trunk stable."
        },
        {
          label: "Level 3 â€“ Box jumps",
          sets: 2,
          durationSeconds: 0,
          reps: "2â€“3 sets of 8â€“10 jumps",
          recommendation: "Use a stable box of sensible height; always step down if players are tired.",
          description:
            "Stand in front of a sturdy box or step. Dip at the hips and knees, then jump up onto the box, landing with both feet fully on the surface and knees bent. " +
            "Step or lightly jump down and reset."
        }
      ]
    },

    // PART 3 â€“ RUNNING
    {
      id: "13",
      part: "Part 3 â€“ Running exercises",
      name: "Running â€“ Across the pitch",
      sequenceIndex: 13,
      levels: [
        {
          label: "Standard",
          sets: 2,
          durationSeconds: 0,
          reps: "2â€“3 runs across the pitch with easy jog back",
          recommendation: "Use this to smoothly increase running intensity toward match pace.",
          description:
            "Run across the field at a comfortable but purposeful pace and jog back to recover. " +
            "Maintain relaxed shoulders, steady arm swing and long, efficient strides."
        }
      ]
    },
    {
      id: "14",
      part: "Part 3 â€“ Running exercises",
      name: "Running â€“ Bounding",
      sequenceIndex: 14,
      levels: [
        {
          label: "Standard",
          sets: 2,
          durationSeconds: 0,
          reps: "2â€“3 bounding runs of 20â€“30 m",
          recommendation: "Tell players to think of 'long and light' rather than 'high and heavy'.",
          description:
            "Perform exaggerated, powerful running strides so that each step covers more ground than usual. " +
            "Push strongly off the ground, land on the forefoot with the knee slightly bent, and keep the trunk upright."
        }
      ]
    },
    {
      id: "15",
      part: "Part 3 â€“ Running exercises",
      name: "Running â€“ Plant and cut",
      sequenceIndex: 15,
      levels: [
        {
          label: "Standard",
          sets: 2,
          durationSeconds: 0,
          reps: "2â€“3 sets of 6â€“10 cuts per side",
          recommendation: "Work at game-like speed but stop if players lose knee control.",
          description:
            "Run forward at moderate to high speed, then slow and plant one foot firmly next to a cone to change direction sharply. " +
            "Push off that leg and accelerate into the new direction, keeping the knee bent and aligned over the foot during the plant step."
        }
      ]
    }
  ];

  // ------------------ State ------------------
  let currentIndex = 0;
  let currentLevelIndex = 0;
  let timerInterval = null;
  let timerRemaining = 0;
  let timerRunning = false;
  let pirateMode = false;

  const SETS_KEY = "fifa11_sets_progress_v2";
  let setsState = {};

  function loadSetsState() {
    try {
      const raw = localStorage.getItem(SETS_KEY);
      if (raw) setsState = JSON.parse(raw);
    } catch {
      setsState = {};
    }
  }
  function saveSetsState() {
    try {
      localStorage.setItem(SETS_KEY, JSON.stringify(setsState));
    } catch {}
  }

  // ------------------ Pirate text ------------------
  function pirateify(text) {
    if (!text) return text;
    let t = text;
    const replacements = [
      [/\byou\b/gi, "ye"],
      [/\byour\b/gi, "yer"],
      [/\bcoach\b/gi, "capt'n"],
      [/\bcoaches\b/gi, "capt'ns"],
      [/\bplayer\b/gi, "matey"],
      [/\bplayers\b/gi, "mateys"],
      [/\bfriend\b/gi, "matey"],
      [/\bfriends\b/gi, "mateys"],
      [/\bleg\b/gi, "sea leg"],
      [/\blegs\b/gi, "sea legs"],
      [/\bknee\b/gi, "knee o' the sea"],
      [/\bball\b/gi, "cannonball"],
      [/\brun\b/gi, "sail"],
      [/\brunning\b/gi, "sailing"],
      [/\bruns\b/gi, "voyages"],
      [/\bhips\b/gi, "hip bones"],
      [/\bhold\b/gi, "grip"],
      [/\bexercise\b/gi, "drill"],
      [/\bexercises\b/gi, "drills"]
    ];
    for (const [regex, repl] of replacements) t = t.replace(regex, repl);
    if (t.length > 40 && !t.startsWith("Arrr")) {
      t = "Arrr, " + t.charAt(0).toLowerCase() + t.slice(1);
    }
    return t;
  }
  function tt(text) {
    return pirateMode ? pirateify(text) : text;
  }

  // ------------------ DOM ------------------
  const exerciseListEl = document.getElementById("exerciseList");
  const searchInput = document.getElementById("searchInput");
  const sidebar = document.getElementById("sidebar");
  const toggleSidebarBtn = document.getElementById("toggleSidebarBtn");
  const pirateToggleBtn = document.getElementById("pirateToggleBtn");
  const resetSessionBtn = document.getElementById("resetSessionBtn");

  const sidebarTitleEl = document.getElementById("sidebarTitle");
  const currentTitleEl = document.getElementById("currentTitle");
  const currentPartEl = document.getElementById("currentPart");
  const levelsHeadingEl = document.getElementById("levelsHeading");
  const levelsSubtitleEl = document.getElementById("levelsSubtitle");
  const setsHeadingEl = document.getElementById("setsHeading");
  const timerHeadingEl = document.getElementById("timerHeading");

  const levelsContainer = document.getElementById("levelsContainer");
  const setsContainer = document.getElementById("setsContainer");
  const timerDisplay = document.getElementById("timerDisplay");
  const timerStartPauseBtn = document.getElementById("timerStartPauseBtn");
  const timerResetBtn = document.getElementById("timerResetBtn");
  const timerCard = document.getElementById("timerCard");
  const setsCard = document.getElementById("setsCard");

  const prevCard = document.getElementById("prevCard");
  const nextCard = document.getElementById("nextCard");
  const prevTitleEl = document.getElementById("prevTitle");
  const nextTitleEl = document.getElementById("nextTitle");
  const prevLabelEl = document.getElementById("prevLabel");
  const nextLabelEl = document.getElementById("nextLabel");

  // ------------------ Rendering ------------------
  function renderExerciseList(filter = "") {
    exerciseListEl.innerHTML = "";
    const query = filter.trim().toLowerCase();

    exercises.forEach((ex, index) => {
      if (
        query &&
        !ex.name.toLowerCase().includes(query) &&
        !ex.part.toLowerCase().includes(query)
      ) return;

      const item = document.createElement("div");
      item.className = "exercise-item" + (index === currentIndex ? " active" : "");
      const title = document.createElement("div");
      title.className = "exercise-title";
      title.textContent = tt(`${ex.id}. ${ex.name}`);
      const part = document.createElement("div");
      part.className = "exercise-part";
      part.textContent = tt(ex.part);

      item.appendChild(title);
      item.appendChild(part);
      item.addEventListener("click", () => {
        setCurrentIndex(index);
        if (window.innerWidth <= 800) sidebar.classList.remove("open");
      });
      exerciseListEl.appendChild(item);
    });

    sidebarTitleEl.textContent = tt("FIFA 11+ List");
  }

  function setCurrentIndex(index) {
    if (index < 0 || index >= exercises.length) return;
    currentIndex = index;
    currentLevelIndex = 0;
    renderExerciseList(searchInput.value);
    renderCurrentExercise();
  }

  function getActiveExerciseAndLevel() {
    const ex = exercises[currentIndex];
    const level =
      ex.levels[Math.max(0, Math.min(currentLevelIndex, ex.levels.length - 1))];
    return { ex, level };
  }

  function renderCurrentExercise() {
    const { ex, level } = getActiveExerciseAndLevel();

    currentTitleEl.textContent = tt(ex.name);
    currentPartEl.textContent = tt(ex.part);
    levelsHeadingEl.textContent = tt("Levels / Variations");
    levelsSubtitleEl.textContent = tt("Tap a level to focus its sets & timer");
    setsHeadingEl.textContent = tt("Sets");
    timerHeadingEl.textContent = tt("Timer");
    prevLabelEl.textContent = tt("Previous");
    nextLabelEl.textContent = tt("Next");
    resetSessionBtn.textContent = tt("Reset session");

    // Levels
    levelsContainer.innerHTML = "";
    if (!ex.levels || ex.levels.length === 0) {
      const p = document.createElement("p");
      p.textContent = tt("No specific levels defined for this exercise.");
      p.style.fontSize = "14px";
      p.style.color = "var(--text-muted)";
      levelsContainer.appendChild(p);
    } else {
      ex.levels.forEach((lvl, idx) => {
        const card = document.createElement("div");
        card.className = "level-card" + (idx === currentLevelIndex ? " active" : "");

        const name = document.createElement("div");
        name.className = "level-name";
        name.textContent = tt(lvl.label);

        const desc = document.createElement("div");
        desc.className = "level-desc";
        desc.textContent = tt(lvl.description);

        card.appendChild(name);
        card.appendChild(desc);

        if (lvl.reps) {
          const row = document.createElement("div");
          row.className = "level-meta-row";
          const label = document.createElement("span");
          label.className = "level-meta-label";
          label.textContent = tt("Reps / time");
          const chip = document.createElement("span");
          chip.className = "level-meta-chip";
          chip.textContent = tt(lvl.reps);
          row.appendChild(label);
          row.appendChild(chip);
          card.appendChild(row);
        }

        if (lvl.recommendation) {
          const row = document.createElement("div");
          row.className = "level-meta-row";
          const label = document.createElement("span");
          label.className = "level-meta-label";
          label.textContent = tt("Coach note");
          const note = document.createElement("span");
          note.className = "level-meta-note";
          note.textContent = tt(lvl.recommendation);
          row.appendChild(label);
          row.appendChild(note);
          card.appendChild(row);
        }

        card.addEventListener("click", () => {
          currentLevelIndex = idx;
          stopTimer();
          initTimerForCurrentLevel();
          initSetsForCurrentLevel();
          renderCurrentExercise();
        });

        levelsContainer.appendChild(card);
      });
    }

    // Sets & timer
    initSetsForCurrentLevel();
    initTimerForCurrentLevel();

    // Navigation previews
    const prevEx = currentIndex > 0 ? exercises[currentIndex - 1] : null;
    const nextEx =
      currentIndex < exercises.length - 1 ? exercises[currentIndex + 1] : null;

    if (prevEx) {
      prevCard.style.visibility = "visible";
      prevTitleEl.textContent = tt(prevEx.name);
    } else prevCard.style.visibility = "hidden";

    if (nextEx) {
      nextCard.style.visibility = "visible";
      nextTitleEl.textContent = tt(nextEx.name);
    } else nextCard.style.visibility = "hidden";
  }

  function initSetsForCurrentLevel() {
    const { ex, level } = getActiveExerciseAndLevel();
    const totalSets = level.sets || 0;
    setsContainer.innerHTML = "";

    if (totalSets > 0) {
      setsCard.style.display = "";
      const key = `${ex.id}_${currentLevelIndex}`;
      if (!setsState[key] || setsState[key].length !== totalSets) {
        setsState[key] = new Array(totalSets).fill(false);
      }
      setsState[key].forEach((checked, i) => {
        const row = document.createElement("label");
        row.className = "set-item";
        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.checked = !!checked;
        cb.addEventListener("change", () => {
          setsState[key][i] = cb.checked;
          saveSetsState();
        });
        const span = document.createElement("span");
        span.textContent = tt(`Set ${i + 1}`);
        row.appendChild(cb);
        row.appendChild(span);
        setsContainer.appendChild(row);
      });
    } else {
      setsCard.style.display = "none";
    }
  }

  function initTimerForCurrentLevel() {
    const { level } = getActiveExerciseAndLevel();
    const duration = level.durationSeconds || 0;
    if (duration > 0) {
      timerCard.style.display = "";
      timerRemaining = duration;
      timerRunning = false;
      updateTimerDisplay();
      timerStartPauseBtn.textContent = tt("Start");
    } else {
      timerCard.style.display = "none";
      stopTimer();
    }
  }

  // ------------------ Timer ------------------
  function updateTimerDisplay() {
    const m = String(Math.floor(timerRemaining / 60)).padStart(2, "0");
    const s = String(timerRemaining % 60).padStart(2, "0");
    timerDisplay.textContent = `${m}:${s}`;
  }
  function startTimer() {
    if (timerRunning || timerRemaining <= 0) return;
    timerRunning = true;
    timerStartPauseBtn.textContent = tt("Pause");
    timerInterval = setInterval(() => {
      if (timerRemaining <= 1) {
        timerRemaining = 0;
        updateTimerDisplay();
        stopTimer();
        return;
      }
      timerRemaining -= 1;
      updateTimerDisplay();
    }, 1000);
  }
  function pauseTimer() {
    timerRunning = false;
    timerStartPauseBtn.textContent = tt("Start");
    if (timerInterval) {
      clearInterval(timerInterval);
      timerInterval = null;
    }
  }
  function stopTimer() {
    timerRunning = false;
    if (timerInterval) {
      clearInterval(timerInterval);
      timerInterval = null;
    }
  }
  function resetTimer() {
    const { level } = getActiveExerciseAndLevel();
    const duration = level.durationSeconds || 0;
    timerRemaining = duration;
    stopTimer();
    updateTimerDisplay();
    timerStartPauseBtn.textContent = tt("Start");
  }

  // ------------------ Events ------------------
  searchInput.addEventListener("input", () => {
    renderExerciseList(searchInput.value);
  });

  timerStartPauseBtn.addEventListener("click", () => {
    const { level } = getActiveExerciseAndLevel();
    if (!level.durationSeconds || level.durationSeconds <= 0) return;
    if (timerRunning) pauseTimer(); else startTimer();
  });

  timerResetBtn.addEventListener("click", () => {
    const { level } = getActiveExerciseAndLevel();
    if (!level.durationSeconds || level.durationSeconds <= 0) return;
    resetTimer();
  });

  prevCard.addEventListener("click", () => {
    setCurrentIndex(currentIndex - 1);
  });
  nextCard.addEventListener("click", () => {
    setCurrentIndex(currentIndex + 1);
  });

  toggleSidebarBtn.addEventListener("click", () => {
    sidebar.classList.toggle("open");
  });

  pirateToggleBtn.addEventListener("click", () => {
    pirateMode = !pirateMode;
    document.body.classList.toggle("pirate", pirateMode);
    pirateToggleBtn.textContent = pirateMode
      ? "â˜  Pirate mode: ON"
      : "â˜  Pirate mode";
    renderExerciseList(searchInput.value);
    renderCurrentExercise();
  });

  resetSessionBtn.addEventListener("click", () => {
    const msg = pirateMode
      ? "Arrr, clear all yer sets fer this voyage?"
      : "Reset all sets for this session?";
    if (!confirm(msg)) return;
    setsState = {};
    try { localStorage.removeItem(SETS_KEY); } catch {}
    renderCurrentExercise();
  });

  // ------------------ Init ------------------
  exercises.sort((a, b) => a.sequenceIndex - b.sequenceIndex);
  loadSetsState();
  renderExerciseList();
  setCurrentIndex(0);
</script>
</body>
</html>
